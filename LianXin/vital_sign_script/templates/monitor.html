<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿå‘½ä½“å¾ç›‘æ§ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .control-panel {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            min-height: 200px; /* ç¡®ä¿ä¸SSHè¿æ¥é…ç½®åŒºåŸŸé«˜åº¦ä¸€è‡´ */
        }
        .ssh-config, .monitor-config {
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.12);
            transition: all 0.3s ease;
        }
        .ssh-config h3, .monitor-config h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
        }
        .test-btn {
            background-color: #17a2b8;
            color: white;
            margin-bottom: 10px;
        }
        #connectionStatus {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        #connectionStatus.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        #connectionStatus.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05), 0 0 8px rgba(74,144,226,0.3);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .horizontal-buttons {
            flex-direction: row;
            gap: 15px;
        }
        
        .horizontal-buttons button {
            flex: 1;
            min-width: 120px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .start-btn {
            background-color: #28a745;
            color: white;
        }
        .stop-btn {
            background-color: #dc3545;
            color: white;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .data-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .data-card {
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.12);
            transition: box-shadow 0.3s ease;
        }
        
        .data-card:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.18);
        }
        .data-card h3 {
            margin-top: 0;
            color: #333;
        }
        .chart-container {
            margin-top: 30px;
            height: 400px;
        }
    </style>
    
    <style>
        /* å¿ƒç‡æ•°æ®è®°å½•æ ·å¼ */
        .bpm-records {
            width: 100%;
        }
        
        #bpmRecords {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 1px;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .bpm-record {
            padding: 8px 4px;
            background-color: #ffffff;
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif;
            font-size: 13px;
            color: #495057;
            text-align: center;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #f8f9fa;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s ease;
        }
        
        .bpm-record:hover {
            background-color: #f8f9fa;
        }
        
        .bpm-record.empty {
            background-color: #f8f9fa;
            color: #adb5bd;
            font-weight: normal;
        }
        
        .bpm-record:nth-child(20n) {
            border-right: none;
        }
        
        .bpm-record:nth-last-child(-n+20) {
            border-bottom: none;
        }
        
        /* æ‰‹åŠ¨è¾“å…¥å¿ƒç‡æ•°æ®æ ·å¼ï¼ˆæ¯è¡Œ20ä¸ªå•å…ƒæ ¼ï¼‰ */
        #manualBpmRecords {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 1px;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            overflow: hidden;
        }
        
        #manualBpmRecords .bpm-record {
            padding: 8px 4px;
            background-color: #ffffff;
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif;
            font-size: 13px;
            color: #495057;
            text-align: center;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #f8f9fa;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s ease;
        }
        
        #manualBpmRecords .bpm-record:hover {
            background-color: #f8f9fa;
        }
        
        #manualBpmRecords .bpm-record.empty {
            background-color: #f8f9fa;
            color: #adb5bd;
            font-weight: normal;
        }
        
        #manualBpmRecords .bpm-record:nth-child(20n) {
            border-right: none;
        }
        
        #manualBpmRecords .bpm-record:nth-last-child(-n+20) {
            border-bottom: none;
        }
        
        .bpm-records-wrapper {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .current-bpm {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            transition: background-color 0.3s ease;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .current-bpm.highlight {
            background-color: #fff3cd;
            color: #856404;
        }
    </style>
    
</head>
<body>
    <div class="container">
        <h1>ç”Ÿå‘½ä½“å¾ç›‘æ§ç³»ç»Ÿ</h1>
        
        <div class="control-panel" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
            <div class="ssh-config">
                 <h3>SSHè¿æ¥é…ç½®</h3>
                 <div class="input-group" style="padding: 0 10px;">
                     <label for="hostname">æœåŠ¡å™¨åœ°å€ï¼š</label>
                     <input type="text" id="hostname" placeholder="ä¾‹å¦‚ï¼š192.168.1.100">
                 </div>
                 <div class="input-group" style="padding: 0 10px;">
                     <label for="username">ç”¨æˆ·åï¼š</label>
                     <input type="text" id="username" placeholder="SSHç”¨æˆ·å">
                 </div>
                 <div class="input-group" style="padding: 0 10px;">
                     <label for="password">å¯†ç ï¼š</label>
                     <input type="password" id="password" placeholder="SSHå¯†ç ">
                 </div>
                 <div style="padding: 0 10px; margin: 10px 0;">
                     <label>
                         <input type="checkbox" id="saveConfig"> ä¿å­˜æœåŠ¡å™¨é…ç½®
                     </label>
                 </div>
                 <div class="button-group horizontal-buttons" style="padding: 0 10px;">
                     <button id="testConnectionBtn" class="start-btn" style="height: 38px; padding: 8px 16px; font-size: 14px;">æµ‹è¯•è¿æ¥</button>
                     <button id="clearConfigBtn" style="height: 38px; padding: 8px 16px; font-size: 14px; background-color: #6c757d; color: white;">æ¸…é™¤ä¿å­˜é…ç½®</button>
                 </div>
                 <div id="connectionStatus" style="margin: 10px 10px 0;"></div>
             </div>

             <div class="monitor-config" style="background-color: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); min-height: 280px; display: flex; flex-direction: column; justify-content: space-between;">
                  <div>
                      <h3>ç›‘æ§é…ç½®</h3>
                      <div class="input-group" style="padding: 0 10px; margin-bottom: 25px;">
                          <label for="poseLogFile">åŠ¨ä½œè¯†åˆ«æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š</label>
                          <input type="text" id="poseLogFile" placeholder="è¾“å…¥åŠ¨ä½œè¯†åˆ«æ—¥å¿—æ–‡ä»¶çš„å®Œæ•´è·¯å¾„" style="width: 100%;">
                      </div>
                      <div class="button-group horizontal-buttons" style="padding: 0 10px; margin-bottom: 40px;">
                          <button id="startPoseBtn" class="start-btn">å¼€å§‹åŠ¨ä½œè¯†åˆ«</button>
                          <button id="stopPoseBtn" class="stop-btn">åœæ­¢åŠ¨ä½œè¯†åˆ«</button>
                          <button id="clearStatsBtn" style="background-color: #6c757d; color: white;">æ¸…ç©ºç»Ÿè®¡æ•°æ®</button>
                      </div>
                      <div style="height: 15px;"></div>
                      <div class="input-group" style="padding: 0 10px; margin-bottom: 25px;">
                          <label for="bpmLogFile">å¿ƒç‡æ£€æµ‹æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š</label>
                          <input type="text" id="bpmLogFile" placeholder="è¾“å…¥å¿ƒç‡æ£€æµ‹æ—¥å¿—æ–‡ä»¶çš„å®Œæ•´è·¯å¾„" style="width: 100%;">
                      </div>
                  </div>
                  <div class="button-group horizontal-buttons" style="padding: 0 10px; margin-top: auto; margin-bottom: 30px;">
                      <button id="startBpmBtn" class="start-btn">å¼€å§‹å¿ƒç‡æ£€æµ‹</button>
                      <button id="stopBpmBtn" class="stop-btn">åœæ­¢å¿ƒç‡æ£€æµ‹</button>
                      <button id="clearBpmBtn" style="background-color: #6c757d; color: white;">æ¸…ç©ºç»Ÿè®¡æ•°æ®</button>
                  </div>
              </div>
        </div>

        <div class="data-display">
            <div class="data-card">
                <h3>åŠ¨ä½œè¯†åˆ«ç»Ÿè®¡</h3>
                <div id="poseStats"></div>
            </div>
            <div class="data-card">
                    <h3>å¿ƒç‡æ£€æµ‹ç»Ÿè®¡</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #ddd; border-radius: 6px;">
                        <thead>
                            <tr style="background-color: #f5f5f5;">
                                <th style="padding: 10px; border: 1px solid #ddd; text-align: left; font-weight: bold; border-top-left-radius: 6px;">æŒ‡æ ‡</th>
                                <th style="padding: 10px; border: 1px solid #ddd; text-align: center; font-weight: bold; border-top-right-radius: 6px;">æ•°å€¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: left; border-bottom: 1px solid #ddd;">å½“å‰å¿ƒç‡</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; border-bottom: 1px solid #ddd;">
                                     <span id="currentHeartRate">0</span> BPM
                                 </td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: left; border-bottom: 1px solid #ddd;">å¹³å‡å¿ƒç‡</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; border-bottom: 1px solid #ddd;">
                                    <span id="avgHeartRate">0</span> BPM
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: left; border-bottom: 1px solid #ddd;">ä¸­ä½æ•°å¿ƒç‡</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; border-bottom: 1px solid #ddd;">
                                    <span id="medianHeartRate">0</span> BPM
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: left; border-bottom-left-radius: 6px;">æ£€æµ‹æ¬¡æ•°</td>
                                <td style="padding: 10px; border: 1px solid #ddd; text-align: center; border-bottom-right-radius: 6px;">
                                    <span id="totalHeartCount">0</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="bpmStats"></div>
                </div>
        </div>

        <!-- ç‹¬ç«‹çš„å¿ƒç‡æ•°æ®è®°å½•åŠŸèƒ½åŒº -->
        <div class="data-card" style="grid-column: 1 / -1; margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">æ£€æµ‹å¿ƒç‡å†å²è®°å½•</h3>
                <button onclick="copyBpmData()" style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">ğŸ“‹ å¤åˆ¶æ‰€æœ‰æ•°æ®</button>
            </div>
            <div class="bpm-records">
                <div id="bpmRecords">
                    <!-- å®æ—¶å¿ƒç‡æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            <div id="copyStatus" style="margin-top: 10px; color: #28a745; display: none;">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>
        </div>

        <!-- å®æ—¶å¿ƒç‡å†å²è®°å½•åŠŸèƒ½åŒº -->
        <div class="data-card" style="grid-column: 1 / -1; margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0;">å®é™…å¿ƒç‡å†å²è®°å½•</h3>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" id="manualBpmInput" placeholder="è¾“å…¥å½“å‰å®é™…å¿ƒç‡" 
                           style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 120px;"
                           min="1" max="300" step="1">
                    <button onclick="addManualBpm()" style="padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">æ·»åŠ </button>
                    <button onclick="deleteLastManualBpm()" style="padding: 8px 16px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">åˆ é™¤</button>
                    <button onclick="clearManualBpmData()" style="padding: 8px 16px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">æ¸…ç©ºæ•°æ®</button>
                    <button onclick="copyManualBpmData()" style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">ğŸ“‹ å¤åˆ¶æ‰€æœ‰æ•°æ®</button>
                </div>
            </div>
            <div class="bpm-records">
                <div id="manualBpmRecords">
                    <!-- æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            <div id="manualCopyStatus" style="margin-top: 10px; color: #28a745; display: none;">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>
            <div id="deviationTips" style="margin-top: 10px; padding: 10px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px; display: none;"></div>
            <div id="manualBpmStats" style="margin-top: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>ç»Ÿè®¡ä¿¡æ¯ï¼š</strong>
                    <span id="manualTotalCount">0</span> æ¡è®°å½• | 
                    å¹³å‡: <span id="manualAvgBpm">0</span> BPM | 
                    ä¸­ä½æ•°: <span id="manualMedianBpm">0</span> BPM
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
                    <span>åå·®å‡å€¼: <span id="manualDeviationMean">-</span> BPM</span>
                    <button onclick="calculateDeviationMean()" style="padding: 4px 8px; background-color: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">è®¡ç®—åå·®å‡å€¼</button>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="bpmChart"></canvas>
        </div>
    </div>

    <script>
        let bpmChart = null;
        let updateInterval = null;

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const ctx = document.getElementById('bpmChart').getContext('2d');
            bpmChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'æ£€æµ‹å¿ƒç‡ (BPM)',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'å®é™…å¿ƒç‡ (BPM)',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.1,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateChart(bpmData) {
            if (!bpmChart) return;
            
            // ç¡®ä¿åªæ˜¾ç¤ºæœ€è¿‘80ä¸ªæ•°æ®ç‚¹
            const displayData = bpmData.slice(-80);
            const labels = displayData.map((item, index) => {
                // å¦‚æœæ˜¯æ—¶é—´æˆ³ï¼Œä½¿ç”¨ç®€åŒ–æ ¼å¼ï¼Œå¦åˆ™ä½¿ç”¨åºå·
                return item.timestamp || `${index + 1}`;
            });
            const values = displayData.map(item => item.value);

            bpmChart.data.labels = labels;
            bpmChart.data.datasets[0].data = values;
            bpmChart.update();
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®ï¼ˆåŒ…å«æ‰‹åŠ¨è¾“å…¥å¿ƒç‡ï¼‰
        function updateChartWithManualData(bpmData, manualBpmData) {
            if (!bpmChart) return;
            
            // ç¡®ä¿åªæ˜¾ç¤ºæœ€è¿‘80ä¸ªæ•°æ®ç‚¹
            const displayData = bpmData.slice(-80);
            const labels = displayData.map((item, index) => {
                return item.timestamp || `${index + 1}`;
            });
            
            // æ£€æµ‹å¿ƒç‡æ•°æ®
            const detectedValues = displayData.map(item => item.value);
            
            // æ‰‹åŠ¨è¾“å…¥å¿ƒç‡æ•°æ®ï¼ˆä¸æ£€æµ‹å¿ƒç‡æ•°æ®å¯¹é½ï¼‰
            const manualValues = [];
            if (manualBpmData && manualBpmData.history) {
                const manualHistory = manualBpmData.history.slice(-80);
                for (let i = 0; i < displayData.length; i++) {
                    if (i < manualHistory.length) {
                        manualValues.push(manualHistory[i].value);
                    } else {
                        manualValues.push(null); // å¡«å……nullä»¥ä¿æŒæ•°æ®å¯¹é½
                    }
                }
            }

            bpmChart.data.labels = labels;
            bpmChart.data.datasets[0].data = detectedValues; // æ£€æµ‹å¿ƒç‡
            bpmChart.data.datasets[1].data = manualValues;   // æ‰‹åŠ¨è¾“å…¥å¿ƒç‡
            bpmChart.update();
        }

        // å­˜å‚¨ä¸Šä¸€æ¬¡çš„å§¿æ€æ•°æ®ï¼Œç”¨äºæ£€æµ‹å˜åŒ–
        let lastPoseData = {};
        
        // æ·»åŠ é—ªçƒåŠ¨ç”»çš„CSSæ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes highlight {
                0% { background-color: rgba(75, 192, 192, 0.4); }
                50% { background-color: rgba(75, 192, 192, 0.7); }
                100% { background-color: transparent; }
            }
            .highlight-row {
                animation: highlight 1.5s ease-in-out;
            }
        `;
        document.head.appendChild(style);
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
        function updateStats() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    // æ›´æ–°åŠ¨ä½œè¯†åˆ«ç»Ÿè®¡ - ä½¿ç”¨è¡¨æ ¼æ˜¾ç¤ºï¼ŒæŒ‰æŒ‡å®šé¡ºåºæ’åˆ—
                    let poseHtml = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">';
                    poseHtml += '<thead><tr style="background-color: #f5f5f5;"><th style="padding: 10px; border: 1px solid #ddd; text-align: left; border-top-left-radius: 6px;">åŠ¨ä½œç±»å‹</th><th style="padding: 10px; border: 1px solid #ddd; text-align: center; border-top-right-radius: 6px;">è¯†åˆ«æ¬¡æ•°</th></tr></thead>';
                    poseHtml += '<tbody>';
                    
                    const poseOrder = [
                        'others_pose',
                        'bending_over',
                        'hand_on_chest',
                        'convulsion',
                        'fall_down',
                        'rush_wall'
                    ];
                    
                    poseOrder.forEach((key, index) => {
                        const value = data.pose_counters[key] || 0;
                        const displayName = {
                            'others_pose': 'å…¶ä»–åŠ¨ä½œ',
                            'bending_over': 'å¼¯è…°',
                            'hand_on_chest': 'æ‰‹æ‚èƒ¸å£',
                            'convulsion': 'æŠ½æ',
                            'fall_down': 'è·Œå€’',
                            'rush_wall': 'æ’å¢™'
                        }[key];
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæœ‰å˜åŒ–åˆ™æ·»åŠ é«˜äº®ç±»
                        const hasChanged = lastPoseData[key] !== value;
                        const highlightClass = hasChanged ? 'highlight-row' : '';
                        
                        const isLastRow = index === poseOrder.length - 1;
                        const bottomLeftRadius = isLastRow ? 'border-bottom-left-radius: 6px;' : '';
                        const bottomRightRadius = isLastRow ? 'border-bottom-right-radius: 6px;' : '';
                        
                        poseHtml += `<tr class="${highlightClass}" id="pose-row-${key}"><td style="padding: 10px; border: 1px solid #ddd; ${bottomLeftRadius}">${displayName}</td><td style="padding: 10px; border: 1px solid #ddd; text-align: center; ${bottomRightRadius}">${value}</td></tr>`;
                    });
                    
                    poseHtml += '</tbody></table>';
                    document.getElementById('poseStats').innerHTML = poseHtml;
                    
                    // æ›´æ–°ä¸Šä¸€æ¬¡çš„æ•°æ®
                    lastPoseData = {...data.pose_counters};

                    // æ›´æ–°å¿ƒç‡ç»Ÿè®¡ - ç»Ÿè®¡æ¦‚è§ˆ + å®æ—¶æ•°æ®è®°å½•
                    const bpmStats = data.bpm_stats;
                    let bpmHtml = '<div style="margin-bottom: 20px;">';

                    // æ›´æ–°é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ä¸­çš„å½“å‰å¿ƒç‡
                    const currentBpmElement = document.getElementById('currentHeartRate');
                    const newBpm = bpmStats.history && bpmStats.history.length > 0 ? bpmStats.history[bpmStats.history.length - 1].value : 0;
                    
                    if (newBpm !== parseInt(currentBpmElement.textContent)) {
                        currentBpmElement.textContent = newBpm;
                        // è·å–å½“å‰è¡Œå…ƒç´ 
                        const currentRow = currentBpmElement.closest('tr');
                        if (currentRow) {
                            currentRow.classList.add('highlight-row');
                            setTimeout(() => {
                                currentRow.classList.remove('highlight-row');
                            }, 1500);
                        }
                    }
            
            // è®¡ç®—ä¸­ä½æ•°å¿ƒç‡
            let medianBpm = 0;
            if (bpmStats.history && bpmStats.history.length > 0) {
                const sortedBpm = bpmStats.history.map(item => item.value).sort((a, b) => a - b);
                const mid = Math.floor(sortedBpm.length / 2);
                medianBpm = sortedBpm.length % 2 === 0 
                    ? (sortedBpm[mid - 1] + sortedBpm[mid]) / 2 
                    : sortedBpm[mid];
            }
            
            // æ›´æ–°ç»Ÿè®¡è¡¨æ ¼
            document.getElementById('totalHeartCount').textContent = bpmStats.history ? bpmStats.history.length : 0;
            document.getElementById('avgHeartRate').textContent = bpmStats.average !== undefined ? bpmStats.average.toFixed(1) : '0';
            document.getElementById('medianHeartRate').textContent = medianBpm.toFixed(0);
                    
                    // ç»Ÿè®¡æ¦‚è§ˆå·²ç§»è‡³è¡¨æ ¼ä¸­æ˜¾ç¤ºï¼Œè¿™é‡Œä¸å†é‡å¤æ˜¾ç¤º
                    
                    // å®æ—¶æ•°æ®è®°å½• - å·²ç§»è‡³ç‹¬ç«‹åŒºåŸŸï¼Œè¿™é‡Œåªæ˜¾ç¤ºç»Ÿè®¡æ¦‚è§ˆ
                    bpmHtml += '</div>';
                    
                    document.getElementById('bpmStats').innerHTML = bpmHtml;

                    // æ›´æ–°ç‹¬ç«‹çš„å¿ƒç‡æ•°æ®è®°å½•åŒºåŸŸ
                    updateBpmRecords(bpmStats.history);
                    
                    // æ›´æ–°æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®è®°å½•åŒºåŸŸ
                    updateManualBpmRecords(data.manual_bpm_stats ? data.manual_bpm_stats.history : []);
                    
                    // æ›´æ–°æ‰‹åŠ¨è¾“å…¥å¿ƒç‡ç»Ÿè®¡ä¿¡æ¯
                    updateManualBpmStats(data.manual_bpm_stats);
                    
                    // æ›´æ–°å›¾è¡¨ï¼ˆåŒæ—¶æ˜¾ç¤ºæ£€æµ‹å¿ƒç‡å’Œæ‰‹åŠ¨è¾“å…¥å¿ƒç‡ï¼‰
                    if (bpmStats.history) {
                        updateChartWithManualData(bpmStats.history, data.manual_bpm_stats);
                    }
                });
        }

        // ä¿å­˜æœåŠ¡å™¨é…ç½®åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆåŒ…å«æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼‰
        function saveServerConfig(hostname, username, password, poseLogFile, bpmLogFile) {
            const config = {
                hostname: hostname,
                username: username,
                password: password,
                poseLogFile: poseLogFile,
                bpmLogFile: bpmLogFile,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('ssh_server_config', JSON.stringify(config));
        }

        // è‡ªåŠ¨ä¿å­˜æ—¥å¿—æ–‡ä»¶è·¯å¾„
        function autoSaveLogPath(type) {
            const saved = localStorage.getItem('ssh_server_config');
            let config = saved ? JSON.parse(saved) : {};
            
            if (type === 'pose') {
                config.poseLogFile = document.getElementById('poseLogFile').value;
            } else if (type === 'bpm') {
                config.bpmLogFile = document.getElementById('bpmLogFile').value;
            }
            
            localStorage.setItem('ssh_server_config', JSON.stringify(config));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æœåŠ¡å™¨é…ç½®ï¼ˆåŒ…å«æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼‰
        function loadServerConfig() {
            const savedConfig = localStorage.getItem('ssh_server_config');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    document.getElementById('hostname').value = config.hostname || '';
                    document.getElementById('username').value = config.username || '';
                    document.getElementById('password').value = config.password || '';
                    document.getElementById('poseLogFile').value = config.poseLogFile || '';
                    document.getElementById('bpmLogFile').value = config.bpmLogFile || '';
                    document.getElementById('saveConfig').checked = true;
                    
                    return true;
                } catch (e) {
                    console.error('åŠ è½½ä¿å­˜çš„é…ç½®å¤±è´¥:', e);
                    return false;
                }
            }
            return false;
        }

        // æ¸…é™¤ä¿å­˜çš„æœåŠ¡å™¨é…ç½®
        function clearServerConfig() {
            localStorage.removeItem('ssh_server_config');
            
            document.getElementById('saveConfig').checked = false;
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('hostname').value = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('poseLogFile').value = '';
            document.getElementById('bpmLogFile').value = '';
            
            alert('å·²æ¸…é™¤ä¿å­˜çš„æ‰€æœ‰é…ç½®');
        }

        // æµ‹è¯•SSHè¿æ¥
        function testConnection() {
            const hostname = document.getElementById('hostname').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!hostname || !username || !password) {
                alert('è¯·å¡«å†™å®Œæ•´çš„SSHè¿æ¥ä¿¡æ¯');
                return;
            }

            // å¦‚æœå‹¾é€‰äº†ä¿å­˜é…ç½®ï¼Œåˆ™ä¿å­˜
            if (document.getElementById('saveConfig').checked) {
                const poseLogFile = document.getElementById('poseLogFile').value;
                const bpmLogFile = document.getElementById('bpmLogFile').value;
                saveServerConfig(hostname, username, password, poseLogFile, bpmLogFile);
            }

            fetch('/test_connection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ hostname, username, password })
            })
            .then(response => response.json())
            .then(data => {
                const statusDiv = document.getElementById('connectionStatus');
                if (data.status === 'success') {
                    statusDiv.className = 'success';
                    statusDiv.textContent = 'è¿æ¥æˆåŠŸï¼';
                    // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
                    setTimeout(() => {
                        statusDiv.textContent = '';
                        statusDiv.className = '';
                    }, 5000);
                } else {
                    statusDiv.className = 'error';
                    statusDiv.textContent = `è¿æ¥å¤±è´¥ï¼š${data.message}`;
                }
            });
        }

        // è·å–SSHé…ç½®
        function getSSHConfig() {
            const hostname = document.getElementById('hostname').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!hostname || !username || !password) {
                return null;
            }

            return { hostname, username, password };
        }

        // å¼€å§‹ç›‘æ§
        function startMonitoring(type) {
            const logFile = document.getElementById(`${type}LogFile`).value;
            if (!logFile) {
                alert('è¯·è¾“å…¥æ—¥å¿—æ–‡ä»¶è·¯å¾„');
                return;
            }

            const data = {
                log_file: logFile,
                ssh_config: getSSHConfig()
            };

            fetch(`/start/${type}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                document.getElementById(`start${type.charAt(0).toUpperCase() + type.slice(1)}Btn`).disabled = true;
                // åœæ­¢æŒ‰é’®ä¸å†è®¾ç½®disabledï¼Œå§‹ç»ˆå¯ç‚¹å‡»
                // document.getElementById(`stop${type.charAt(0).toUpperCase() + type.slice(1)}Btn`).disabled = false;
            });
        }

        // åœæ­¢ç›‘æ§ - åªåœæ­¢æ—¥å¿—ç›‘æ§ï¼Œä¸æ¸…ç©ºç»Ÿè®¡
        function stopMonitoring(type) {
            fetch(`/stop/${type}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById(`start${type.charAt(0).toUpperCase() + type.slice(1)}Btn`).disabled = false;
                    // åœæ­¢æŒ‰é’®ä¸å†è®¾ç½®ä¸ºdisabledï¼Œå§‹ç»ˆå¯ç‚¹å‡»
                    // document.getElementById(`stop${type.charAt(0).toUpperCase() + type.slice(1)}Btn`).disabled = true;
                });
        }
        
        // æ¸…ç©ºç»Ÿè®¡æ•°æ®
        function clearStats() {
            fetch('/clear_stats', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // å¼ºåˆ¶åˆ·æ–°ç»Ÿè®¡æ•°æ®
                        updateStats();
                    } else {
                        alert('æ¸…ç©ºç»Ÿè®¡æ•°æ®å¤±è´¥');
                    }
                });
        }

        // æ¸…æå¿ƒç‡æ•°æ®
        function clearBpmStats() {
            fetch('/clear_bpm_stats', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // å¼ºåˆ¶åˆ·æ–°ç»Ÿè®¡æ•°æ®
                        updateStats();
                    } else {
                        alert('æ¸…æå¿ƒç‡æ•°æ®å¤±è´¥');
                    }
                });
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            initChart();

            // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¡«å……ä¿å­˜çš„é…ç½®
            loadServerConfig();
            
            // æ·»åŠ æ—¥å¿—æ–‡ä»¶è·¯å¾„è‡ªåŠ¨ä¿å­˜äº‹ä»¶
            document.getElementById('poseLogFile').addEventListener('input', () => autoSaveLogPath('pose'));
            document.getElementById('bpmLogFile').addEventListener('input', () => autoSaveLogPath('bpm'));

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('testConnectionBtn').addEventListener('click', testConnection);
            document.getElementById('startPoseBtn').addEventListener('click', () => startMonitoring('pose'));
            document.getElementById('stopPoseBtn').addEventListener('click', () => stopMonitoring('pose'));
            document.getElementById('startBpmBtn').addEventListener('click', () => startMonitoring('bpm'));
            document.getElementById('stopBpmBtn').addEventListener('click', () => stopMonitoring('bpm'));
            document.getElementById('clearStatsBtn').addEventListener('click', clearStats);
            document.getElementById('clearBpmBtn').addEventListener('click', clearBpmStats);
            document.getElementById('clearConfigBtn').addEventListener('click', clearServerConfig);

            // å¯åŠ¨å®šæ—¶æ›´æ–°
            updateInterval = setInterval(updateStats, 1000);

            // é¡µé¢å…³é—­æ—¶æ¸…ç† - åˆå¹¶æ‰€æœ‰æ¸…ç†é€»è¾‘åˆ°ä¸€ä¸ªç›‘å¬å™¨
            window.addEventListener('beforeunload', () => {
                // ä½¿ç”¨åŒæ­¥XMLHttpRequestç¡®ä¿åœæ­¢æ‰€æœ‰ç›‘æ§
                try {
                    // è°ƒç”¨/stop_allç«¯ç‚¹å®Œå…¨åœæ­¢æ‰€æœ‰ç›‘æ§
                    const xhrStopAll = new XMLHttpRequest();
                    xhrStopAll.open('GET', '/stop_all', false); // åŒæ­¥è¯·æ±‚
                    xhrStopAll.send();
                    
                    // æ¸…ç©ºç»Ÿè®¡æ•°æ®ï¼Œç¡®ä¿å®Œå…¨é‡ç½®
                    const xhrClearStats = new XMLHttpRequest();
                    xhrClearStats.open('POST', '/clear_stats', false);
                    xhrClearStats.setRequestHeader('Content-Type', 'application/json');
                    xhrClearStats.send('{}');
                    
                } catch (e) {
                    console.log('åœæ­¢ç›‘æ§æ—¶å‡ºé”™:', e);
                }
                
                // æ¸…é™¤å®šæ—¶å™¨
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
            });
        });

        // å¤åˆ¶å¿ƒç‡æ•°æ®åˆ°å‰ªè´´æ¿
        function updateBpmRecords(historyData) {
            const recordsContainer = document.getElementById('bpmRecords');
            let recordsHtml = '';
            
            if (historyData && historyData.length > 0) {
                const recentData = historyData.slice(-80); // æ˜¾ç¤ºæœ€è¿‘80ä¸ªæ•°æ®
                recentData.forEach((item, index) => {
                    const bpmValue = typeof item === 'object' ? (item.bpm || item.value || item) : item;
                    recordsHtml += `<div class="bpm-record">${bpmValue}</div>`;
                });
                // å¡«å……ç©ºç™½æ ¼å­ä»¥ä¿æŒç½‘æ ¼å®Œæ•´ï¼ˆ80ä¸ªæ ¼å­ï¼Œ20Ã—4ï¼‰
                const remainingCells = 80 - recentData.length;
                for (let i = 0; i < remainingCells; i++) {
                    recordsHtml += '<div class="bpm-record empty">-</div>';
                }
            } else {
                // æ˜¾ç¤ºç©ºç½‘æ ¼ï¼ˆ80ä¸ªæ ¼å­ï¼‰
                for (let i = 0; i < 80; i++) {
                    recordsHtml += '<div class="bpm-record empty">-</div>';
                }
            }
            
            recordsContainer.innerHTML = recordsHtml;
        }

        function copyBpmData() {
            const records = document.querySelectorAll('#bpmRecords .bpm-record');
            const data = Array.from(records).map(record => record.textContent.trim()).filter(text => text !== '-').join('\n');
            if (!data) {
                alert('æš‚æ— æ•°æ®å¯å¤åˆ¶');
                return;
            }
            navigator.clipboard.writeText(data).then(() => {
                const statusEl = document.getElementById('copyStatus');
                statusEl.style.display = 'inline';
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ•°æ®');
            });
        }

        // æ›´æ–°æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®è®°å½•ï¼ˆæ¯è¡Œ20ä¸ªå•å…ƒæ ¼ï¼Œå…±4è¡Œï¼‰
        function updateManualBpmRecords(historyData) {
            const recordsContainer = document.getElementById('manualBpmRecords');
            let recordsHtml = '';
            
            if (historyData && historyData.length > 0) {
                const recentData = historyData.slice(-80); // æ˜¾ç¤ºæœ€è¿‘80ä¸ªæ•°æ®ï¼ˆ20Ã—4ï¼‰
                recentData.forEach((item, index) => {
                    const bpmValue = typeof item === 'object' ? (item.bpm || item.value || item) : item;
                    recordsHtml += `<div class="bpm-record">${bpmValue}</div>`;
                });
                // å¡«å……ç©ºç™½æ ¼å­ä»¥ä¿æŒç½‘æ ¼å®Œæ•´ï¼ˆ80ä¸ªæ ¼å­ï¼Œ20Ã—4ï¼‰
                const remainingCells = 80 - recentData.length;
                for (let i = 0; i < remainingCells; i++) {
                    recordsHtml += '<div class="bpm-record empty">-</div>';
                }
            } else {
                // æ˜¾ç¤ºç©ºç½‘æ ¼ï¼ˆ80ä¸ªæ ¼å­ï¼Œ20Ã—4ï¼‰
                for (let i = 0; i < 80; i++) {
                    recordsHtml += '<div class="bpm-record empty">-</div>';
                }
            }
            
            recordsContainer.innerHTML = recordsHtml;
        }

        // æ›´æ–°æ‰‹åŠ¨è¾“å…¥å¿ƒç‡ç»Ÿè®¡ä¿¡æ¯
        function updateManualBpmStats(stats) {
            if (stats && stats.history && stats.history.length > 0) {
                document.getElementById('manualTotalCount').textContent = stats.history.length;
                document.getElementById('manualAvgBpm').textContent = stats.average ? stats.average.toFixed(1) : '0';
                document.getElementById('manualMedianBpm').textContent = stats.median ? stats.median.toFixed(0) : '0';
            } else {
                document.getElementById('manualTotalCount').textContent = '0';
                document.getElementById('manualAvgBpm').textContent = '0';
                document.getElementById('manualMedianBpm').textContent = '0';
            }
        }

        // æ·»åŠ æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®
        function addManualBpm() {
            const input = document.getElementById('manualBpmInput');
            const bpmValue = input.value.trim();
            
            if (!bpmValue) {
                alert('è¯·è¾“å…¥å¿ƒç‡å€¼');
                return;
            }

            fetch('/add_manual_bpm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ bpm: bpmValue })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                // æ¸…ç©ºè¾“å…¥æ¡†
                input.value = '';
                // åˆ·æ–°ç»Ÿè®¡æ•°æ®
                updateStats();
            })
            .catch(error => {
                console.error('æ·»åŠ å¿ƒç‡æ•°æ®å¤±è´¥:', error);
                alert('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            });
        }

        // æ¸…ç©ºæ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®
        function clearManualBpmData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®å—ï¼Ÿ')) {
                fetch('/clear_manual_bpm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // åˆ·æ–°ç»Ÿè®¡æ•°æ®
                        updateStats();
                    } else {
                        alert('æ¸…ç©ºæ•°æ®å¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', error);
                    alert('æ¸…ç©ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                });
            }
        }

        // å¤åˆ¶æ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®
        function copyManualBpmData() {
            const records = document.querySelectorAll('#manualBpmRecords .bpm-record');
            const data = Array.from(records).map(record => record.textContent.trim()).filter(text => text !== '-').join('\n');
            if (!data) {
                alert('æš‚æ— æ•°æ®å¯å¤åˆ¶');
                return;
            }
            navigator.clipboard.writeText(data).then(() => {
                const statusEl = document.getElementById('manualCopyStatus');
                statusEl.style.display = 'inline';
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ•°æ®');
            });
        }

        // åˆ é™¤æœ€åä¸€ä¸ªæ‰‹åŠ¨è¾“å…¥çš„å¿ƒç‡æ•°æ®
        function deleteLastManualBpm() {
            fetch('/delete_last_manual_bpm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                // åˆ·æ–°ç»Ÿè®¡æ•°æ®
                updateStats();
            })
            .catch(error => {
                console.error('åˆ é™¤å¿ƒç‡æ•°æ®å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            });
        }

        // è®¡ç®—å¿ƒç‡åå·®å‡å€¼
        function calculateDeviationMean() {
            fetch('/calculate_deviation_mean')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showDeviationTips(data.error, 'error');
                        return;
                    }
                    
                    // æ›´æ–°åå·®å‡å€¼æ˜¾ç¤º
                    document.getElementById('manualDeviationMean').textContent = data.deviation_mean;
                    
                    // æ˜¾ç¤ºè®¡ç®—ä¿¡æ¯ï¼ˆTipsæ ·å¼ï¼‰
                    showDeviationTips(`è®¡ç®—å®Œæˆï¼ä½¿ç”¨æ•°æ®å¯¹: ${data.data_pairs_used}å¯¹ï¼Œåå·®å‡å€¼: ${data.deviation_mean} BPM`, 'success');
                })
                .catch(error => {
                    console.error('è®¡ç®—åå·®å‡å€¼å¤±è´¥:', error);
                    showDeviationTips('è®¡ç®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                });
        }

        // æ˜¾ç¤ºåå·®è®¡ç®—Tips
        function showDeviationTips(message, type) {
            const tipsEl = document.getElementById('deviationTips');
            tipsEl.textContent = message;
            tipsEl.style.display = 'block';
            
            // è®¾ç½®æ ·å¼åŸºäºç±»å‹
            if (type === 'success') {
                tipsEl.style.backgroundColor = '#d4edda';
                tipsEl.style.color = '#155724';
                tipsEl.style.borderColor = '#c3e6cb';
            } else if (type === 'error') {
                tipsEl.style.backgroundColor = '#f8d7da';
                tipsEl.style.color = '#721c24';
                tipsEl.style.borderColor = '#f5c6cb';
            }
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                tipsEl.style.display = 'none';
            }, 3000);
        }

        // ä¸ºè¾“å…¥æ¡†æ·»åŠ å›è½¦é”®æ”¯æŒ
        document.getElementById('manualBpmInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addManualBpm();
            }
        });
    </script>
</body>
</html>